<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…æ›¸è±ªè¯ç‰ˆ - åœ–å½¢åŒ–ç•Œé¢</title>
    <style>
        :root { --gold: #f1c40f; --red: #e74c3c; --dark: #1a1a2e; --card-w: 120px; --card-h: 170px; }
        
        body { font-family: "PingFang TC", sans-serif; background: #0c0c16; color: white; margin: 0; padding: 20px; }
        .game-card { width: 95%; max-width: 1300px; margin: auto; }

        /* å¡ç‰ŒåŸºç¤æ¨£å¼ */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            border: 2px solid #444;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            display: inline-block;
            margin: 5px;
        }
        .card:hover {
            transform: translateY(-15px) scale(1.05);
            box-shadow: 0 15px 30px rgba(241, 196, 15, 0.4);
            border-color: var(--gold);
        }
        /* å¡ç‰Œä¸Šçš„æ•¸å­—æ¨™ç±¤ */
        .card-val {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0,0,0,0.7);
            color: var(--gold);
            width: 25px;
            height: 25px;
            text-align: center;
            border-radius: 50%;
            line-height: 25px;
            font-weight: bold;
        }

        /* ç‰Œå †èˆ‡éŠæˆ²æ¡Œæ’ç‰ˆ */
        .table-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .player-slot {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 15px;
            min-width: 250px;
            text-align: center;
            border: 2px solid transparent;
        }
        .player-slot.active { border-color: var(--gold); background: rgba(241, 196, 15, 0.1); }
        .player-slot.out { opacity: 0.5; filter: grayscale(0.8); }

        /* æ·˜æ±°ç¿»ç‰Œ */
        .dead-card {
            width: 80px;
            height: 110px;
            margin: 10px auto;
            border: 1px solid var(--red);
        }

        #log {
            background: rgba(0,0,0,0.5);
            height: 150px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: flex;
            flex-direction: column-reverse;
        }
        
        .hand-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        button.control-btn {
            background: var(--gold);
            color: black;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="game-card">
    <h1 style="text-align: center; color: var(--gold);">ğŸ’Œ æƒ…æ›¸ï¼šè¦–è¦ºåŒ–æ——è‰¦ç‰ˆ</h1>

    <div id="setup" style="text-align: center; padding: 100px;">
        <input type="number" id="pCount" value="4" min="2" max="8" style="font-size: 20px; padding: 10px;">
        <button class="control-btn" onclick="bootGame()">é€²å…¥ç‰Œå±€</button>
    </div>

    <div id="main" style="display: none;">
        <div id="log"></div>
        <div id="players" class="table-area"></div>
    </div>
</div>

<script>
    // é€™è£¡è«‹æ ¹æ“šä½ çš„æª”æ¡ˆè·¯å¾‘ä¿®æ”¹åœ–ç‰‡è·¯å¾‘
    // å¦‚æœåœ–ç‰‡åœ¨ assets è³‡æ–™å¤¾ï¼Œè«‹æ”¹æˆ `assets/card${v}.png`
    const getCardImg = (v) => `card${v}.png`; 
    const CARD_BACK = `card_back.png`;

    const CARD_DATA = [
        { v: 1, name: "è¡›å…µ", count: 10 }, { v: 2, name: "ç¥çˆ¶", count: 4 },
        { v: 3, name: "ç”·çˆµ", count: 4 }, { v: 4, name: "ä¾å¥³", count: 4 },
        { v: 5, name: "ç‹å­", count: 4 }, { v: 6, name: "åœ‹ç‹", count: 2 },
        { v: 7, name: "ä¼¯çˆµå¤«äºº", count: 2 }, { v: 8, name: "å…¬ä¸»", count: 2 }
    ];

    let deck = [], players = [], currentIdx = 0, dir = 1, isOver = false;

    function bootGame() {
        const num = document.getElementById('pCount').value;
        deck = [];
        CARD_DATA.forEach(c => { for(let i=0; i<c.count; i++) deck.push({...c}); });
        deck.sort(() => Math.random() - 0.5);
        players = Array.from({length: num}, (_, i) => ({
            id: i, name: i === 0 ? "ä½ " : `NPC ${i}`,
            hand: [deck.pop()], isOut: false, lastHand: null, isProt: false, isNPC: i !== 0
        }));
        document.getElementById('setup').style.display = 'none';
        document.getElementById('main').style.display = 'block';
        addLog("ğŸ² ç‰Œå±€åˆå§‹åŒ–ä¸­...");
        setTimeout(resolveRPS, 1000);
    }

    // (ä¸­é–“çš„çŒœæ‹³ã€æ–¹å‘ã€æ›äººé‚è¼¯èˆ‡å‰å¹¾ç‰ˆç›¸åŒï¼Œç¶­æŒç©©å®šæ€§)
    // é€™è£¡é‡é»å±•ç¤ºæ¸²æŸ“éƒ¨åˆ†çš„æ”¹è®Š

    function updateUI() {
        const container = document.getElementById('players');
        container.innerHTML = "";

        players.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `player-slot ${p.isOut ? 'out' : ''} ${i === currentIdx ? 'active' : ''}`;
            
            let html = `<h3>${p.name} ${p.isProt ? 'ğŸ›¡ï¸' : ''}</h3>`;
            
            if (p.isOut) {
                html += `<p>æ·˜æ±° (æŒæœ‰:${p.lastHand.name})</p>`;
                html += `<div class="card dead-card" style="background-image: url('${getCardImg(p.lastHand.v)}')"></div>`;
            } else if (i === 0) { // çœŸäººç©å®¶é¡¯ç¤ºæ‰‹ç‰Œåœ–ç‰‡
                html += `<div class="hand-container">`;
                p.hand.forEach((card, ci) => {
                    html += `
                        <div class="card" style="background-image: url('${getCardImg(card.v)}')" onclick="playCard(0, ${ci})">
                            <div class="card-val">${card.v}</div>
                        </div>`;
                });
                html += `</div>`;
            } else { // NPC é¡¯ç¤ºå¡èƒŒ
                html += `<div class="hand-container">`;
                p.hand.forEach(() => {
                    html += `<div class="card" style="background-image: url('${CARD_BACK}'); cursor: default;"></div>`;
                });
                html += `</div>`;
            }
            
            div.innerHTML = html;
            container.appendChild(div);
        });
    }

    // å…¶é¤˜é‚è¼¯æ¯”ç…§å‰ç‰ˆä¿®æ­£å¾Œå…§å®¹... (æ­¤è™•ç‚ºé•·åº¦çœç•¥ï¼Œå»ºè­°å°‡å‰ä¸€ç‰ˆçš„ playCard, npcSmartPlay ç­‰å‡½æ•¸è£œå›)
</script>
